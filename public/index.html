<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Learnox Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --primary: #667eea; --secondary: #764ba2; --bg: #eef2f5; --white: #ffffff; --green: #25d366; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, var(--primary), var(--secondary)); height: 100vh; display: flex; align-items: center; justify-content: center; }
        
        /* Auth */
        .auth-box { background: var(--white); padding: 40px; border-radius: 15px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .input-group { margin-bottom: 15px; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px; outline: none; transition: 0.3s; }
        .input-group input:focus { border-color: var(--primary); }
        .btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        /* Main App */
        .app { display: none; width: 95vw; height: 95vh; background: var(--white); border-radius: 20px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.3); display: flex; }
        
        /* Sidebar */
        .sidebar { width: 350px; background: #fff; border-right: 1px solid #ddd; display: flex; flex-direction: column; }
        .my-profile { padding: 15px; background: #f8f9fa; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #ddd; }
        .avatar-circle { width: 45px; height: 45px; border-radius: 50%; background: #ddd; overflow: hidden; }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
        
        .tabs { display: flex; background: #f1f1f1; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; color: #666; border-bottom: 3px solid transparent; }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); background: #fff; font-weight: bold; }
        
        .list { flex: 1; overflow-y: auto; }
        .list-item { padding: 15px; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s; border-bottom: 1px solid #f5f5f5; position: relative; }
        .list-item:hover { background: #f9f9f9; }
        .list-item.active { background: #eef2ff; border-left: 4px solid var(--primary); }
        
        .unread-badge { background: var(--primary); color: white; font-size: 11px; padding: 2px 6px; border-radius: 10px; margin-left: auto; }
        
        /* Chat Area */
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #e5ddd5; position: relative; }
        .chat-header { padding: 10px 20px; background: #fff; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 15px; }
        .typing-indicator { font-size: 12px; color: var(--primary); font-style: italic; height: 15px; display: none; }
        
        .messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); }
        
        .msg { max-width: 70%; padding: 8px 12px; border-radius: 8px; font-size: 14px; position: relative; display: flex; flex-direction: column; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .msg.sent { align-self: flex-end; background: #dcf8c6; }
        .msg.received { align-self: flex-start; background: #fff; }
        
        .msg-meta { display: flex; align-items: center; justify-content: flex-end; gap: 4px; font-size: 10px; color: #777; margin-top: 4px; }
        
        /* Ticks */
        .tick { width: 14px; height: 14px; display: inline-block; background-size: contain; background-repeat: no-repeat; }
        .tick-sent { color: #999; } /* 1 Grey */
        .tick-delivered { color: #999; } /* 2 Grey */
        .tick-seen { color: #34b7f1; } /* 2 Blue */
        
        .input-bar { padding: 10px; background: #fff; display: flex; align-items: center; gap: 10px; }
        .input-bar input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        
        /* Modals & Context Menu */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: #fff; padding: 25px; border-radius: 10px; width: 90%; max-width: 400px; text-align: center; }
        
        .context-menu { position: absolute; background: white; border: 1px solid #ddd; box-shadow: 2px 2px 10px rgba(0,0,0,0.1); border-radius: 5px; display: none; z-index: 1000; width: 120px; }
        .context-item { padding: 10px; cursor: pointer; font-size: 13px; }
        .context-item:hover { background: #eee; }

        .hidden { display: none !important; }
        .online-dot { width: 10px; height: 10px; background: var(--green); border-radius: 50%; border: 2px solid white; position: absolute; bottom: 0; right: 0; }
        
        /* Mobile */
        @media(max-width: 768px) {
            .app { width: 100%; height: 100%; border-radius: 0; }
            .sidebar { width: 100%; display: flex; }
            .chat-area { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 20; }
            .chat-area.active { display: flex; }
        }
    </style>
</head>
<body>

    <div id="auth-screen" class="auth-box">
        <h2 align="center" style="margin-bottom: 20px; color: var(--primary);">Learnox Pro</h2>
        <div id="auth-error" style="color:red; text-align:center; margin-bottom:10px;"></div>
        <input type="text" id="reg-username" class="hidden input-group" placeholder="Username (Unique ID)" style="width:100%; padding:10px; margin-bottom:10px;">
        <input type="text" id="reg-name" class="hidden input-group" placeholder="Full Name" style="width:100%; padding:10px; margin-bottom:10px;">
        <input type="email" id="email" placeholder="Email Address" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
        <input type="password" id="password" placeholder="Password" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
        <button onclick="handleAuth()" class="btn" id="auth-btn">Login</button>
        <p style="text-align: center; margin-top: 15px; cursor: pointer; color: #666;" onclick="toggleAuth()">New User? Create Account</p>
    </div>

    <div id="app-screen" class="app hidden">
        <div class="sidebar">
            <div class="my-profile">
                <div style="display:flex; gap:10px; align-items:center; cursor: pointer;" onclick="showMyProfile()">
                    <div class="avatar-circle"><img id="my-avatar" src=""></div>
                    <div>
                        <b id="my-display-name">...</b>
                        <div style="font-size:12px; color:#888;">@<span id="my-username-display"></span></div>
                    </div>
                </div>
                <i class="fas fa-sign-out-alt" onclick="logout()" style="cursor: pointer; color:#d9534f;"></i>
            </div>
            <div class="tabs">
                <div class="tab active" onclick="setTab('chats')">Chats</div>
                <div class="tab" onclick="setTab('find')">Find People</div>
                <div class="tab" onclick="setTab('requests')">Requests</div>
            </div>
            
            <div style="padding: 10px;">
                <input type="text" id="search-input" placeholder="Search..." style="width:100%; padding:8px; border:1px solid #eee; border-radius:5px;" onkeyup="handleSearch()">
            </div>

            <div id="list-container" class="list"></div>
        </div>

        <div id="chat-interface" class="chat-area">
            <div class="chat-header">
                <i class="fas fa-arrow-left" onclick="closeChat()" style="cursor: pointer; display: none;" id="back-btn"></i>
                <div class="avatar-circle"><img id="chat-avatar" src=""></div>
                <div style="flex:1; cursor: pointer;" onclick="viewFriendProfile()">
                    <h4 id="chat-name">User</h4>
                    <span id="chat-status" style="font-size:12px; color:#666;">Offline</span>
                    <div id="typing-indicator" class="typing-indicator">typing...</div>
                </div>
                <i class="fas fa-trash" title="Clear Chat" onclick="clearChat()" style="margin-right: 15px; cursor: pointer; color: #d9534f;"></i>
                <i class="fas fa-ban" title="Block" onclick="blockUser()" style="cursor: pointer; color: #777;"></i>
            </div>
            
            <div id="messages-box" class="messages"></div>
            
            <div class="input-bar">
                <i class="far fa-smile" style="font-size:20px; color:#777; cursor:pointer;" onclick="alert('Emoji picker coming next update!')"></i>
                <input type="text" id="msg-input" placeholder="Type a message..." autocomplete="off">
                <button onclick="sendMsg()" style="background:var(--primary); color:white; border:none; padding:10px 15px; border-radius:50%; cursor:pointer;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        
        <div id="empty-state" class="chat-area" style="display:flex; align-items:center; justify-content:center; background:#f0f2f5;">
            <div style="text-align:center; color:#888;">
                <i class="fas fa-comments" style="font-size:50px; margin-bottom:10px;"></i>
                <h2>Select a chat</h2>
            </div>
        </div>
    </div>

    <div id="ctx-menu" class="context-menu">
        <div class="context-item" onclick="handleCtxAction('delete')">Delete Message</div>
        <div class="context-item" onclick="handleCtxAction('edit')">Edit Message</div>
    </div>

    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="avatar-circle" style="width:100px; height:100px; margin:0 auto;"><img id="view-p-avatar" src="" style="width:100%;height:100%;"></div>
            <h2 id="view-p-name" style="margin-top:10px;"></h2>
            <p id="view-p-username" style="color:#666;">@...</p>
            <p id="view-p-status" style="margin-top:5px; font-weight:bold; color:var(--primary);"></p>
            <br>
            <button class="btn" onclick="document.getElementById('profile-modal').style.display='none'">Close</button>
        </div>
    </div>

    <script>
        const API = '/api';
        let socket, token, me, currentChatId, currentChatUser;
        let isLogin = true;
        let selectedMsgId = null;
        let typingTimeout;

        // --- AUTH ---
        function toggleAuth() {
            isLogin = !isLogin;
            document.querySelector('#auth-btn').innerText = isLogin ? 'Login' : 'Register';
            document.querySelector('#reg-name').classList.toggle('hidden');
            document.querySelector('#reg-username').classList.toggle('hidden');
        }

        async function handleAuth() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('reg-name').value;
            const username = document.getElementById('reg-username').value;
            
            const url = isLogin ? '/login' : '/register';
            const body = isLogin ? { email, password } : { email, password, name, username };

            try {
                const res = await fetch(API + url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                if(data.error) throw new Error(data.error);
                
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                location.reload();
            } catch(e) { document.getElementById('auth-error').innerText = e.message; }
        }

        function logout() { localStorage.clear(); location.reload(); }

        // --- INIT ---
        window.onload = () => {
            token = localStorage.getItem('token');
            if(token) {
                me = JSON.parse(localStorage.getItem('user'));
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-screen').classList.remove('hidden');
                
                document.getElementById('my-display-name').innerText = me.name;
                document.getElementById('my-username-display').innerText = me.username;
                document.getElementById('my-avatar').src = me.avatar || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';

                initSocket();
                setTab('chats');
                
                if (Notification.permission !== "granted") Notification.requestPermission();
            }
        };

        function initSocket() {
            socket = io({ auth: { token } });
            
            // Real-time Updates
            socket.on('new_message', (msg) => {
                if(currentChatId === msg.chat) {
                    appendMsg(msg);
                    socket.emit('join_chat', currentChatId); // Mark as read immediately
                    scrollToBottom();
                } else {
                    notifyUser(msg);
                    refreshChatList(); // Update unread count
                }
            });

            socket.on('msg_status_update', ({ msgId, status }) => {
                const tickEl = document.getElementById(`tick-${msgId}`);
                if(tickEl) tickEl.innerHTML = getTickIcon(status);
            });

            socket.on('msgs_seen', ({ chatId }) => {
                if(currentChatId === chatId) {
                    document.querySelectorAll('.tick-icon').forEach(el => el.innerHTML = getTickIcon('seen'));
                }
            });
            
            // Typing
            socket.on('typing_start', ({ userId }) => {
                if(currentChatUser && currentChatUser._id === userId) 
                    document.getElementById('typing-indicator').style.display = 'block';
            });
            socket.on('typing_stop', () => document.getElementById('typing-indicator').style.display = 'none');

            // Online Status
            socket.on('user_status', ({ userId, status }) => {
                if(currentChatUser && currentChatUser._id === userId) {
                    document.getElementById('chat-status').innerText = status === 'online' ? 'Online' : 'Offline';
                }
                refreshChatList(); // Update dots
            });
            
            // Deletion/Editing
            socket.on('message_deleted', ({ _id, chatId }) => {
                if(currentChatId === chatId) {
                    const el = document.getElementById(`msg-${_id}`);
                    if(el) el.remove();
                }
            });
            socket.on('message_updated', (msg) => {
                if(currentChatId === msg.chat) {
                    document.querySelector(`#msg-${msg._id} .text-content`).innerText = msg.text;
                    document.querySelector(`#msg-${msg._id} .meta-edited`).style.display = 'inline';
                }
            });
        }

        // --- TABS & LISTS ---
        async function setTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            const list = document.getElementById('list-container');
            list.innerHTML = '<div style="text-align:center; padding:20px;">Loading...</div>';

            if(tab === 'chats') refreshChatList();
            else if(tab === 'find') {
                list.innerHTML = '<p style="text-align:center; padding:20px; color:#888;">Type Username to search</p>';
            } else if(tab === 'requests') {
                // Fetch requests logic
                const res = await fetchWithAuth('/api/users/search?q=a'); // Hack to get structure, better endpoint needed
                // For simplicity in this code block, search handles requests display too
                list.innerHTML = '<p style="text-align:center; padding:20px;">Use Search to find people. Requests appear in Notifications.</p>';
            }
        }

        async function refreshChatList() {
            const res = await fetchWithAuth('/chats');
            const chats = await res.json();
            const list = document.getElementById('list-container');
            list.innerHTML = '';
            
            chats.forEach(chat => {
                const other = chat.participants.find(p => p._id !== me.id);
                if(!other) return;
                
                const div = document.createElement('div');
                div.className = 'list-item';
                div.onclick = () => openChat(other, chat._id);
                div.innerHTML = `
                    <div class="avatar-circle">
                        <img src="${other.avatar || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}">
                        ${other.status === 'online' ? '<div class="online-dot"></div>' : ''}
                    </div>
                    <div style="flex:1;">
                        <h4>${other.name}</h4>
                        <p style="font-size:12px; color:#666; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">
                            ${chat.lastMessage ? chat.lastMessage.text : 'Start chatting'}
                        </p>
                    </div>
                    ${chat.unreadCount > 0 ? `<div class="unread-badge">${chat.unreadCount}</div>` : ''}
                `;
                list.appendChild(div);
            });
        }

        async function handleSearch() {
            const q = document.getElementById('search-input').value;
            if(q.length < 2) return;
            
            const res = await fetchWithAuth(`/users/search?q=${q}`);
            const users = await res.json();
            const list = document.getElementById('list-container');
            list.innerHTML = '';

            users.forEach(u => {
                const div = document.createElement('div');
                div.className = 'list-item';
                let btnHtml = '';
                if(u.requestStatus === 'none') btnHtml = `<button onclick="sendReq('${u._id}')" style="padding:5px 10px;">Add</button>`;
                else if(u.requestStatus === 'pending' && u.requestId) btnHtml = `<button disabled>Sent</button>`;
                else if(u.requestStatus === 'accepted') btnHtml = `<button onclick="startChat('${u._id}')">Chat</button>`;

                div.innerHTML = `
                    <div class="avatar-circle"><img src="${u.avatar || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}"></div>
                    <div><h4>${u.name}</h4><small>@${u.username}</small></div>
                    <div style="margin-left:auto;">${btnHtml}</div>
                `;
                list.appendChild(div);
            });
        }

        // --- ACTIONS ---
        async function sendReq(id) {
            await fetchWithAuth('/friend-request', 'POST', { receiverId: id });
            alert('Request Sent');
            handleSearch();
        }

        async function startChat(userId) {
            const res = await fetchWithAuth('/chats', 'POST', { targetId: userId });
            const chat = await res.json();
            const user = chat.participants.find(p => p._id === userId);
            openChat(user, chat._id);
        }

        async function openChat(user, chatId) {
            currentChatUser = user;
            currentChatId = chatId;
            
            // UI Switch (Mobile friendly)
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('chat-interface').classList.remove('hidden');
            if(window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.add('hidden');
                document.getElementById('chat-interface').classList.add('active');
                document.getElementById('back-btn').style.display = 'block';
            }

            document.getElementById('chat-name').innerText = user.name;
            document.getElementById('chat-status').innerText = user.status === 'online' ? 'Online' : 'Last seen: ' + new Date(user.lastSeen).toLocaleTimeString();
            document.getElementById('chat-avatar').src = user.avatar || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';

            // Load Messages
            socket.emit('join_chat', chatId);
            const msgs = await (await fetchWithAuth(`/messages/${chatId}`)).json();
            const box = document.getElementById('messages-box');
            box.innerHTML = '';
            msgs.forEach(appendMsg);
            scrollToBottom();
        }

        function closeChat() {
            document.getElementById('chat-interface').classList.remove('active');
            document.getElementById('chat-interface').classList.add('hidden');
            document.querySelector('.sidebar').classList.remove('hidden');
            document.getElementById('empty-state').classList.remove('hidden');
            currentChatId = null;
        }

        // --- MESSAGING ---
        async function sendMsg() {
            const input = document.getElementById('msg-input');
            const text = input.value.trim();
            if(!text || !currentChatId) return;

            // Optimistic UI
            const tempId = 'temp-' + Date.now();
            const tempMsg = {
                _id: tempId,
                text,
                sender: me.id,
                createdAt: new Date().toISOString(),
                status: 'sent'
            };
            appendMsg(tempMsg);
            input.value = '';
            scrollToBottom();

            // Send to Server
            try {
                const res = await fetchWithAuth('/messages', 'POST', { chatId: currentChatId, text, tempId });
                const savedMsg = await res.json();
                
                // Update DOM with real ID and ticks
                const el = document.getElementById(`msg-${tempId}`);
                if(el) {
                    el.id = `msg-${savedMsg._id}`;
                    el.querySelector('.tick-icon').innerHTML = getTickIcon(savedMsg.status);
                    // Attach context menu listener
                    el.oncontextmenu = (e) => showCtxMenu(e, savedMsg._id);
                }
            } catch(e) {
                console.error(e);
                alert('Failed to send');
            }
        }

        function appendMsg(msg) {
            const isMe = msg.sender === me.id || msg.sender._id === me.id;
            const div = document.createElement('div');
            div.className = `msg ${isMe ? 'sent' : 'received'}`;
            div.id = `msg-${msg._id}`;
            
            const time = new Date(msg.createdAt).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            const tickHtml = isMe ? `<span class="tick-icon" id="tick-${msg._id}">${getTickIcon(msg.status)}</span>` : '';
            
            div.innerHTML = `
                <span class="text-content">${msg.text}</span>
                <div class="msg-meta">
                    <span class="meta-edited" style="display:${msg.edited?'inline':'none'}">(edited)</span>
                    <span>${time}</span>
                    ${tickHtml}
                </div>
            `;
            
            // Interaction
            if(isMe) {
                // Right click for desktop, Long press for mobile logic (simplified to right click here)
                div.oncontextmenu = (e) => showCtxMenu(e, msg._id);
            }
            
            document.getElementById('messages-box').appendChild(div);
        }

        // --- UTILS ---
        function getTickIcon(status) {
            if(status === 'sent') return '<i class="fas fa-check tick-sent"></i>'; // 1 Grey
            if(status === 'delivered') return '<i class="fas fa-check-double tick-delivered"></i>'; // 2 Grey
            if(status === 'seen') return '<i class="fas fa-check-double tick-seen"></i>'; // 2 Blue
            return '<i class="far fa-clock"></i>';
        }

        const msgInput = document.getElementById('msg-input');
        msgInput.addEventListener('input', () => {
            if(currentChatId) {
                socket.emit('typing_start', { chatId: currentChatId });
                clearTimeout(typingTimeout);
                typingTimeout = setTimeout(() => socket.emit('typing_stop', { chatId: currentChatId }), 1000);
            }
        });
        msgInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMsg(); });

        function scrollToBottom() {
            const b = document.getElementById('messages-box');
            b.scrollTop = b.scrollHeight;
        }

        function notifyUser(msg) {
            if(Notification.permission === "granted") {
                new Notification("New Message", { body: msg.text });
            }
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3'); // Simple beep
            audio.play().catch(e => {});
        }

        async function fetchWithAuth(url, method='GET', body=null) {
            const opts = {
                method,
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }
            };
            if(body) opts.body = JSON.stringify(body);
            return fetch(API + url, opts);
        }

        // --- CONTEXT MENU (Edit/Delete) ---
        function showCtxMenu(e, msgId) {
            e.preventDefault();
            if(msgId.startsWith('temp')) return;
            selectedMsgId = msgId;
            const menu = document.getElementById('ctx-menu');
            menu.style.display = 'block';
            menu.style.left = e.pageX + 'px';
            menu.style.top = e.pageY + 'px';
        }

        async function handleCtxAction(action) {
            document.getElementById('ctx-menu').style.display = 'none';
            if(!selectedMsgId) return;

            if(action === 'delete') {
                if(!confirm('Delete message?')) return;
                await fetchWithAuth(`/messages/${selectedMsgId}`, 'DELETE');
                // Socket handles removal
            } else if (action === 'edit') {
                const el = document.querySelector(`#msg-${selectedMsgId} .text-content`);
                const newText = prompt("Edit message:", el.innerText);
                if(newText && newText !== el.innerText) {
                    await fetchWithAuth(`/messages/${selectedMsgId}`, 'PUT', { text: newText });
                }
            }
        }
        
        // Hide context menu on click elsewhere
        window.addEventListener('click', () => document.getElementById('ctx-menu').style.display = 'none');

        async function clearChat() {
            if(confirm('Delete all messages in this chat for you?')) {
                await fetchWithAuth(`/chats/${currentChatId}`, 'DELETE');
                document.getElementById('messages-box').innerHTML = '';
            }
        }
        
        async function blockUser() {
            if(confirm('Block this user?')) {
                await fetchWithAuth('/block', 'POST', { userId: currentChatUser._id });
                alert('User Blocked');
                location.reload();
            }
        }

        async function viewFriendProfile() {
            if(!currentChatUser) return;
            const res = await fetchWithAuth(`/user/${currentChatUser._id}`);
            const data = await res.json();
            document.getElementById('view-p-name').innerText = data.name;
            document.getElementById('view-p-username').innerText = '@' + data.username;
            document.getElementById('view-p-avatar').src = data.avatar || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
            document.getElementById('view-p-status').innerText = data.status === 'online' ? 'Online' : 'Offline';
            document.getElementById('profile-modal').style.display = 'flex';
        }
    </script>
</body>
</html>